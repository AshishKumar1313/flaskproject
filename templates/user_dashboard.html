{% extends 'base.html' %}
{% block title %}My Dashboard â€“ FlaskBlog{% endblock %}

{% block content %}
<div class="container py-5">
  <h3 class="fw-bold mb-4"><i class="fas fa-tachometer-alt me-2 text-primary"></i>My Dashboard</h3>

  <!-- Profile Card -->
  <div class="card shadow-sm mb-4">
    <div class="card-body d-flex align-items-center gap-4">
      {% if current_user.profile_pic %}
      <img src="{{ current_user.profile_pic }}" width="70" height="70" class="rounded-circle border" alt="Profile"/>
      {% else %}
      <div class="rounded-circle bg-primary d-flex align-items-center justify-content-center" style="width:70px;height:70px">
        <span class="text-white fw-bold fs-3">{{ current_user.username[0].upper() }}</span>
      </div>
      {% endif %}
      <div>
        <h5 class="mb-0 fw-bold">{{ current_user.username }}</h5>
        <small class="text-muted">{{ current_user.email }}</small>
        <div class="mt-1">
          <span class="badge {{ 'bg-danger' if current_user.is_admin() else ('bg-primary' if current_user.is_author() else 'bg-secondary') }}">
            {{ current_user.role.title() }}
          </span>
          {% if current_user.firebase_uid %}
          <span class="badge bg-info ms-1"><i class="fab fa-google me-1"></i>Google Account</span>
          {% endif %}
        </div>
      </div>
    </div>
  </div>

  <!-- My Comments -->
  <h5 class="fw-bold mb-3">My Comments ({{ comments|length }})</h5>

  {% if comments %}
  <div class="card shadow-sm">
    <div class="list-group list-group-flush">
      {% for comment in comments %}
      <div class="list-group-item">
        <div class="d-flex justify-content-between align-items-start">
          <div>
            <p class="mb-1">{{ comment.content }}</p>
            <small class="text-muted">
              On: <a href="{{ url_for('main.post_detail', post_id=comment.post_id) }}" class="text-primary text-decoration-none">
                {{ comment.post.title[:50] }}
              </a>
              &bull; {{ comment.created_at.strftime('%b %d, %Y') }}
            </small>
          </div>
          <form method="POST" action="{{ url_for('main.delete_comment', comment_id=comment.id) }}" onsubmit="return confirm('Delete comment?')">
            <input type="hidden" name="csrf_token" value="{{ csrf_token() }}"/>
            <button type="submit" class="btn btn-sm btn-outline-danger"><i class="fas fa-trash"></i></button>
          </form>
        </div>
      </div>
      {% endfor %}
    </div>
  </div>
  {% else %}
  <div class="text-center py-4 card shadow-sm">
    <i class="fas fa-comment-slash fa-2x text-muted mb-2"></i>
    <p class="text-muted mb-0">You haven't commented on anything yet.</p>
    <a href="{{ url_for('main.index') }}" class="btn btn-outline-primary mt-2">Browse Posts</a>
  </div>
  {% endif %}
</div>
{% endblock %}